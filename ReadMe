import { useEffect, useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import {
  Briefcase,
  GraduationCap,
  Gamepad2,
  Download,
  Link as LinkIcon,
  Mail,
  Phone,
  MapPin,
  Users,
  Check,
} from "lucide-react";

/******************************
 * Perplexity‑inspired Resume (Full App)
 * - Frosted glass, rounded UI
 * - Smooth morph transitions (tabs + cards)
 * - Hover/tap reveal for Experience, Education, Hobbies
 * - Clipboard copy with toast (email/phone labels only)
 * - Download .docx
 * - Footer hover morph text
 * - Smoke tests in console
 ******************************/

const NAV = [
  { key: "experience", label: "Experience", icon: Briefcase },
  { key: "education", label: "Education", icon: GraduationCap },
  { key: "hobbies", label: "Hobbies", icon: Gamepad2 },
  { key: "references", label: "References", icon: Users },
  { key: "download", label: "Download", icon: Download },
];

const GLOBAL_SKILLS = [
  "Teamwork",
  "Leadership",
  "Communication",
  "Planning",
  "Technology (IT & hardware)",
  "Customer Service",
  "Time Management",
  "Problem Solving",
  "Basic Japanese",
];

export default function App() {
  const [page, setPage] = useState("experience");
  const [copied, setCopied] = useState("");
  const [footerHover, setFooterHover] = useState(false);

  function copyToClipboard(text, label) {
    const toast = () => {
      setCopied(label);
      setTimeout(() => setCopied(""), 1500);
    };
    if (navigator.clipboard?.writeText) {
      navigator.clipboard.writeText(text).then(toast).catch(fallback);
    } else fallback();
    function fallback() {
      try {
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.opacity = "0";
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        toast();
      } catch (e) {
        console.warn("Clipboard unsupported", e);
      }
    }
  }

  useEffect(() => {
    runSmokeTests();
  }, []);

  return (
    <div className="min-h-screen w-full bg-[radial-gradient(60%_80%_at_50%_0%,_#0b1220_0%,_#0a0f1a_35%,_#05070c_100%)] text-slate-100 relative">
      {/* Toast */}
      <AnimatePresence>
        {copied && (
          <motion.div
            key="toast"
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -10 }}
            className="fixed top-5 left-1/2 z-50 -translate-x-1/2 rounded-xl bg-white/10 px-4 py-2 text-sm text-white backdrop-blur-md ring-1 ring-white/20"
            role="status"
            aria-live="polite"
          >
            <Check className="inline mr-1 h-4 w-4" /> Copied {copied} to clipboard
          </motion.div>
        )}
      </AnimatePresence>

      {/* Ambient gradient orbs */}
      <div className="pointer-events-none fixed inset-0 -z-10">
        <div className="absolute -top-20 -left-20 h-96 w-96 rounded-full bg-indigo-500/20 blur-3xl" />
        <div className="absolute -bottom-24 -right-16 h-[28rem] w-[28rem] rounded-full bg-cyan-500/10 blur-3xl" />
      </div>

      {/* Shell */}
      <div className="mx-auto grid max-w-6xl grid-cols-1 gap-6 px-4 py-10 lg:grid-cols-[280px_1fr]">
        {/* Sidebar */}
        <aside className="sticky top-6 h-max">
          <div className="rounded-2xl border border-white/10 bg-white/10 p-5 backdrop-blur-xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.6)]">
            <Header />
            <nav className="mt-6 space-y-2">
              {NAV.map(({ key, label, icon: Icon }) => (
                <button
                  key={key}
                  onClick={() => setPage(key)}
                  className={`group flex w-full items-center gap-3 rounded-xl px-3 py-3 text-left transition ${
                    page === key ? "bg-white/10 ring-1 ring-white/20" : "hover:bg-white/5"
                  }`}
                >
                  <Icon className="h-5 w-5 opacity-90" />
                  <span className="font-medium tracking-tight">{label}</span>
                </button>
              ))}
            </nav>

            {/* Quick actions */}
            <div className="mt-6 grid grid-cols-2 gap-2 text-xs text-slate-300/90">
              <button
                onClick={() => copyToClipboard("oscar.p.beckett@gmail.com", "email")}
                className="flex items-center justify-center gap-2 rounded-lg bg-white/5 px-3 py-2 ring-1 ring-white/10 hover:bg-white/10"
              >
                <Mail className="h-4 w-4" /> email
              </button>
              <button
                onClick={() => copyToClipboard("+61434470221", "phone number")}
                className="flex items-center justify-center gap-2 rounded-lg bg-white/5 px-3 py-2 ring-1 ring-white/10 hover:bg-white/10"
              >
                <Phone className="h-4 w-4" /> phone
              </button>
            </div>
          </div>
        </aside>

        {/* Content */}
        <main className="space-y-6">
          <motion.div layout className="rounded-3xl border border-white/10 bg-white/10 p-1 backdrop-blur-2xl">
            <TabBar page={page} setPage={setPage} />
            <div className="rounded-2xl bg-black/20 p-6 ring-1 ring-white/10">
              {/* Smooth size transitions for tab content */}
              <AnimatePresence mode="wait">
                <motion.div
                  key={page}
                  layout="size"
                  initial={{ opacity: 0, y: 8 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: -8 }}
                  transition={{
                    layout: { type: "spring", stiffness: 180, damping: 42 },
                    duration: 0.18,
                    ease: "easeOut",
                  }}
                  className="min-h-[420px] md:min-h-[360px]"
                >
                  {page === "experience" && (
                    <MorphCard>
                      <Experience />
                    </MorphCard>
                  )}
                  {page === "education" && (
                    <MorphCard>
                      <Education />
                    </MorphCard>
                  )}
                  {page === "hobbies" && (
                    <MorphCard>
                      <HobbiesNew />
                    </MorphCard>
                  )}
                  {page === "references" && (
                    <MorphCard>
                      <References />
                    </MorphCard>
                  )}
                  {page === "download" && (
                    <MorphCard>
                      <DownloadPane />
                    </MorphCard>
                  )}
                </motion.div>
              </AnimatePresence>
            </div>
          </motion.div>

          {/* Footer */}
          <footer className="flex items-center justify-between px-1 text-xs text-slate-400/80">
            <motion.div
              className="flex items-center gap-2 cursor-pointer"
              onMouseEnter={() => setFooterHover(true)}
              onMouseLeave={() => setFooterHover(false)}
              animate={{ opacity: 1 }}
              transition={{ duration: 0.4, ease: "easeInOut" }}
            >
              <LinkIcon className="h-3.5 w-3.5" />
              <motion.span
                key={footerHover ? "hovered" : "normal"}
                initial={{ opacity: 0, y: 6 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -6 }}
                transition={{ duration: 0.4, ease: "easeOut" }}
              >
                {footerHover
                  ? "(I'm good with programs, not programming)"
                  : "Built with ChatGPT 5 Pro Codex."}
              </motion.span>
            </motion.div>
            <span className="opacity-75">© {new Date().getFullYear()} Oscar Beckett</span>
          </footer>
        </main>
      </div>
    </div>
  );
}

function Header() {
  return (
    <div className="flex items-start gap-4">
      <div className="relative h-14 w-14 shrink-0 overflow-hidden rounded-2xl ring-1 ring-white/20">
        <div className="h-full w-full bg-gradient-to-br from-indigo-400/60 to-cyan-400/50" />
      </div>
      <div>
        <h1 className="text-xl font-semibold tracking-tight">Oscar Beckett</h1>
        <p className="text-sm text-slate-300/90">Outdoor adventurer & student • Brisbane, QLD</p>
        <p className="mt-2 flex items-center gap-2 text-xs text-slate-400/90">
          <MapPin className="h-3.5 w-3.5" /> Open to opportunities • GMT+10
        </p>
      </div>
    </div>
  );
}

function TabBar({ page, setPage }) {
  return (
    <div className="relative flex w-full flex-wrap items-center gap-2 p-2">
      {NAV.map(({ key, label, icon: Icon }) => (
        <button
          key={key}
          onClick={() => setPage(key)}
          className="relative rounded-xl px-3 py-2 text-sm text-slate-200/90 transition hover:bg-white/5"
        >
          <div className="flex items-center gap-2">
            <Icon className="h-4 w-4" />
            <span>{label}</span>
          </div>
          {page === key && (
            <motion.div
              layoutId="pill"
              className="absolute inset-0 -z-10 rounded-xl bg-white/10 ring-1 ring-white/20"
              transition={{ type: "spring", stiffness: 220, damping: 32 }}
            />
          )}
        </button>
      ))}
    </div>
  );
}

function MorphCard({ children }) {
  return (
    <motion.section
      layout="size"
      initial={{ opacity: 0, y: 8, scale: 0.98 }}
      animate={{ opacity: 1, y: 0, scale: 1 }}
      exit={{ opacity: 0, y: -8, scale: 0.98 }}
      transition={{ duration: 0.25, ease: "easeOut", layout: { type: "spring", stiffness: 180, damping: 38 } }}
      className="grid gap-4 md:grid-cols-2"
    >
      {children}
    </motion.section>
  );
}

/****************
 * EXPERIENCE
 ****************/
function Experience() {
  const bio =
    "Motivated, responsible, and friendly high‑school student with experience across customer service, hospitality, and outdoor activities. Reliable team member who adapts quickly, communicates well, and contributes positively to any environment.";

  const items = [
    {
      role: "Trolley Collector",
      org: "Controlled Trolley Services (Kmart Stafford)",
      time: "Dec 2023 – Jul 2024",
      points: [
        "Collected and maintained trolleys across large retail carparks.",
        "Provided approachable, helpful customer service on‑site.",
        "Upheld safety and efficiency during peak trading periods.",
      ],
    },
    {
      role: "Barista",
      org: "Zarraffa's Coffee, Brisbane",
      time: "Sep 2022 – Jan 2023",
      points: [
        "Prepared espresso beverages to brand standards at volume.",
        "Delivered friendly service and managed POS during rushes.",
      ],
    },
    {
      role: "Service & Sales Lead",
      org: "Oscar’s Mowing Services, Brisbane",
      time: "Sep 2021 – Jul 2023",
      points: [
        "Delivered economical landscaping for local clients (weeding, ant control, pet‑area cleanups).",
        "Managed bookings, quotes, and repeat customer relationships.",
      ],
    },
  ];

  return (
    <>
      <GlassCard title={<Title left="About Me" right="At a Glance" />}>
        <p className="text-sm text-slate-200/90">{bio}</p>
      </GlassCard>

      {items.map((job, idx) => (
        <JobItem key={idx} job={job} />
      ))}
    </>
  );
}

function JobItem({ job }) {
  const [open, setOpen] = useState(false);

  return (
    <motion.div
      layout="size"
      onMouseEnter={() => setOpen(true)}
      onMouseLeave={() => setOpen(false)}
      onTouchStart={() => setOpen((v) => !v)}
      className="group overflow-hidden rounded-2xl bg-white/10 p-0 ring-1 ring-white/20 backdrop-blur-xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.6)]"
      transition={{ layout: { type: "spring", stiffness: 170, damping: 36 } }}
    >
      <AnimatePresence mode="wait" initial={false}>
        {!open ? (
          <motion.button
            key="summary"
            layout="size"
            className="flex w-full items-center justify-between gap-3 px-5 py-4"
            initial={{ opacity: 0, y: 8, scale: 0.98 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: -8, scale: 0.98 }}
            transition={{ duration: 0.22, ease: "easeOut" }}
            onClick={() => setOpen(true)}
          >
            <div className="min-w-0">
              <h3 className="truncate text-base font-semibold tracking-tight text-white/95">{job.role}</h3>
              <p className="mt-1 truncate text-xs text-slate-300/85">{job.org}</p>
            </div>
            <span className="shrink-0 rounded-lg bg-white/10 px-2 py-1 text-xs text-slate-300 ring-1 ring-white/20">{job.time}</span>
          </motion.button>
        ) : (
          <motion.div
            key="details"
            layout="size"
            className="px-5 py-5"
            initial={{ opacity: 0, y: 8, scale: 0.98 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: -8, scale: 0.98 }}
            transition={{ duration: 0.22, ease: "easeOut" }}
          >
            <div className="mb-3 flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between">
              <h3 className="text-base font-semibold tracking-tight text-white/95">{job.role}</h3>
              <div className="flex flex-wrap items-center gap-2 text-xs">
                <span className="rounded-lg bg-white/10 px-2 py-1 text-slate-300 ring-1 ring-white/20">{job.org}</span>
                <span className="rounded-lg bg-white/10 px-2 py-1 text-slate-300 ring-1 ring-white/20">{job.time}</span>
              </div>
            </div>
            <ul className="list-disc space-y-2 pl-5 text-sm text-slate-200/90">
              {job.points.map((p, i) => (
                <li key={i}>{p}</li>
              ))}
            </ul>
          </motion.div>
        )}
      </AnimatePresence>
    </motion.div>
  );
}

/****************
 * EDUCATION
 ****************/
function Education() {
  const schools = [
    {
      degree: "Senior Secondary (STEM & Arts focus)",
      org: "Kedron State High School, Brisbane",
      time: "2020 – 2025",
      detail:
        "Math Methods, Japanese, Engineering, Physics, Literature, English & Lit Extension; first trombone in Symphony Orchestra, Wind Symphony, Brass Ensemble (AMEB L7).",
    },
    {
      degree: "Primary School",
      org: "Ascot State School, Brisbane",
      time: "2013 – 2019",
      detail:
        "Core subjects, ensembles incl. Senior Band, Brass Ensemble, Stage Band (AMEB L4).",
    },
  ];

  return (
    <>
      {schools.map((s, i) => (
        <SchoolItem key={i} school={s} />
      ))}

      <GlassCard title={<Title left="Skills Snapshot" right="Updated" />}>
        <div className="flex flex-wrap justify-center gap-2 text-sm text-slate-200/90">
          {GLOBAL_SKILLS.map((skill) => (
            <span
              key={skill}
              className="whitespace-nowrap rounded-full bg-white/10 px-4 py-2 text-xs sm:text-sm ring-1 ring-white/20"
            >
              {skill}
            </span>
          ))}
        </div>
      </GlassCard>
    </>
  );
}

function SchoolItem({ school }) {
  const [open, setOpen] = useState(false);

  return (
    <motion.div
      layout="size"
      onMouseEnter={() => setOpen(true)}
      onMouseLeave={() => setOpen(false)}
      onTouchStart={() => setOpen((v) => !v)}
      className="group overflow-hidden rounded-2xl bg-white/10 p-0 ring-1 ring-white/20 backdrop-blur-xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.6)]"
      transition={{ layout: { type: "spring", stiffness: 170, damping: 36 } }}
    >
      <AnimatePresence mode="wait" initial={false}>
        {!open ? (
          <motion.button
            key="summary"
            layout="size"
            className="flex w-full items-center justify-between gap-3 px-5 py-4"
            initial={{ opacity: 0, y: 8, scale: 0.98 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: -8, scale: 0.98 }}
            transition={{ duration: 0.22, ease: "easeOut" }}
            onClick={() => setOpen(true)}
          >
            <div className="min-w-0">
              <h3 className="truncate text-base font-semibold tracking-tight text-white/95">{school.degree}</h3>
              <p className="mt-1 truncate text-xs text-slate-300/85">{school.org}</p>
            </div>
            <span className="shrink-0 rounded-lg bg-white/10 px-2 py-1 text-xs text-slate-300 ring-1 ring-white/20">{school.time}</span>
          </motion.button>
        ) : (
          <motion.div
            key="details"
            layout="size"
            className="px-5 py-5"
            initial={{ opacity: 0, y: 8, scale: 0.98 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: -8, scale: 0.98 }}
            transition={{ duration: 0.22, ease: "easeOut" }}
          >
            <div className="mb-3 flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between">
              <h3 className="text-base font-semibold tracking-tight text-white/95">{school.degree}</h3>
              <div className="flex flex-wrap items-center gap-2 text-xs">
                <span className="rounded-lg bg-white/10 px-2 py-1 text-slate-300 ring-1 ring-white/20">{school.org}</span>
                <span className="rounded-lg bg-white/10 px-2 py-1 text-slate-300 ring-1 ring-white/20">{school.time}</span>
              </div>
            </div>
            <p className="text-sm text-slate-200/90">{school.detail}</p>
          </motion.div>
        )}
      </AnimatePresence>
    </motion.div>
  );
}

/****************
 * HOBBIES (morphing like Experience)
 ****************/
function HobbiesNew() {
  const items = [
    {
      title: "Scouting & Leadership",
      tag: "Awards",
      detail:
        "Grey Wolf Award (2018), Australian Scout Medallion (2022), King’s Scout Award (2025). Venturer service leader at Australian Jamboree 2025. Regularly plan and run activities.",
    },
    {
      title: "Baseball",
      tag: "Club & Rep",
      detail:
        "Playing since 2016; state/national representative level since 2017. Premier team for Windsor Royals Senior League 2023/24 season.",
    },
    {
      title: "Mountain Biking & Cycle Touring",
      tag: "Outdoors",
      detail: "BVRT completed three times; introducing bikepacking to Scouts and peers.",
    },
    {
      title: "Karate (Go‑Kan‑Ryu)",
      tag: "Brown Belt",
      detail: "Training since 2011; assisting in junior dojo sessions and working toward 1st Black Tip.",
    },
    {
      title: "CAD and 3D Printing",
      tag: "Maker",
      detail:
        "Owner of a Bambu Labs A1, and enjoy using Autodesk Inventor and Blender to create new things to be printed.",
    },
  ];

  return (
    <>
      {items.map((h, i) => (
        <HobbyItem key={i} hobby={h} />
      ))}
    </>
  );
}

function HobbyItem({ hobby }) {
  const [open, setOpen] = useState(false);

  return (
    <motion.div
      layout="size"
      onMouseEnter={() => setOpen(true)}
      onMouseLeave={() => setOpen(false)}
      onTouchStart={() => setOpen((v) => !v)}
      className="group overflow-hidden rounded-2xl bg-white/10 p-0 ring-1 ring-white/20 backdrop-blur-xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.6)]"
      transition={{ layout: { type: "spring", stiffness: 170, damping: 36 } }}
    >
      <AnimatePresence mode="wait" initial={false}>
        {!open ? (
          <motion.button
            key="summary"
            layout="size"
            className="flex w-full items-center justify-between gap-3 px-5 py-4"
            initial={{ opacity: 0, y: 8, scale: 0.98 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: -8, scale: 0.98 }}
            transition={{ duration: 0.22, ease: "easeOut" }}
            onClick={() => setOpen(true)}
          >
            <h3 className="truncate text-base font-semibold tracking-tight text-white/95">{hobby.title}</h3>
            <span className="shrink-0 rounded-lg bg-white/10 px-2 py-1 text-xs text-slate-300 ring-1 ring-white/20">{hobby.tag}</span>
          </motion.button>
        ) : (
          <motion.div
            key="details"
            layout="size"
            className="px-5 py-5"
            initial={{ opacity: 0, y: 8, scale: 0.98 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: -8, scale: 0.98 }}
            transition={{ duration: 0.22, ease: "easeOut" }}
          >
            <div className="mb-3 flex items-center justify-between gap-2">
              <h3 className="text-base font-semibold tracking-tight text-white/95">{hobby.title}</h3>
              <span className="shrink-0 rounded-lg bg-white/10 px-2 py-1 text-xs text-slate-300 ring-1 ring-white/20">{hobby.tag}</span>
            </div>
            <p className="text-sm text-slate-200/90">{hobby.detail}</p>
          </motion.div>
        )}
      </AnimatePresence>
    </motion.div>
  );
}

/****************
 * REFERENCES
 ****************/
function References() {
  const refs = [
    { name: "Rachel Beckett", role: "Mother", contact: "Available on request" },
    { name: "Employers & Team Leaders", role: "Workplace supervisors", contact: "Available on request" },
  ];
  return (
    <>
      {refs.map((r, i) => (
        <GlassCard key={i} title={<Title left={r.name} right={r.role} />}>
          <p className="text-sm text-slate-200/90">{r.contact}</p>
        </GlassCard>
      ))}
    </>
  );
}

/****************
 * DOWNLOAD
 ****************/
function DownloadPane() {
  return (
    <GlassCard title={<Title left="Download my resume (Oscar_Beckett_CV_2.docx)" right="Printable" />}>
      <p className="mb-4 text-sm text-slate-200/90">Click below to download the Word document version of my resume.</p>
      <a
        href="/Oscar_Beckett_CV_2.docx"
        download
        className="inline-flex items-center gap-2 rounded-xl bg-white/90 px-4 py-2 font-medium text-slate-900 ring-1 ring-white/30 transition hover:bg-white"
      >
        <Download className="h-4 w-4" /> Download Resume
      </a>
    </GlassCard>
  );
}

/****************
 * SHARED UI
 ****************/
function GlassCard({ title, children }) {
  return (
    <motion.div
      layout="size"
      transition={{ layout: { type: "spring", stiffness: 170, damping: 36 } }}
      className="rounded-2xl bg-white/10 p-5 ring-1 ring-white/20 backdrop-blur-xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.6)]"
    >
      <div className="mb-3 flex items-center justify-between gap-3">
        {typeof title === "string" ? (
          <h3 className="text-base font-semibold tracking-tight">{title}</h3>
        ) : (
          title
        )}
      </div>
      {children}
    </motion.div>
  );
}

function Title({ left, right }) {
  return (
    <div className="flex w-full items-center justify-between gap-3">
      <h3 className="text-base font-semibold tracking-tight text-white/95">{left}</h3>
      {right ? (
        <span className="shrink-0 rounded-lg bg-white/10 px-2 py-1 text-xs text-slate-300 ring-1 ring-white/20">{right}</span>
      ) : null}
    </div>
  );
}

/****************
 * Smoke tests
 ****************/
function runSmokeTests() {
  try {
    const keys = NAV.map((n) => n.key);
    console.assert(new Set(keys).size === keys.length, "[TEST] Duplicate tab keys", keys);
    ["experience", "education", "hobbies", "references", "download"].forEach((k) => {
      console.assert(keys.includes(k), "[TEST] Missing tab:", k);
    });
    console.assert(typeof GlassCard === "function", "[TEST] GlassCard missing");
    console.assert(typeof Title === "function", "[TEST] Title missing");
    console.assert(Array.isArray(GLOBAL_SKILLS) && GLOBAL_SKILLS.length > 0, "[TEST] Skills empty");
    console.assert("/Oscar_Beckett_CV_2.docx".endsWith(".docx"), "[TEST] Download href incorrect");
    console.assert(typeof MorphCard === "function" && typeof HobbyItem === "function", "[TEST] Morph components");
    console.assert(typeof JobItem === "function" && typeof SchoolItem === "function", "[TEST] Item components");
    console.assert(typeof References === "function" && typeof DownloadPane === "function", "[TEST] Core tabs present");
    console.log("[TEST] Smoke tests passed");
  } catch (e) {
    console.error("[TEST] Smoke tests error", e);
  }
}
